{% macro product_card(product, show_delete=False) %}
<div
  class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-all duration-300 flex flex-col h-full group"
>
  <!-- Image -->
  <div
    class="aspect-square bg-gray-100 relative overflow-hidden cursor-pointer"
    onclick="openProductModal({{ product | tojson }})"
  >
    <img
      src="{{ url_for('serve_image', table='products', id=product.id) }}"
      alt="{{ product.name }}"
      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
      onerror="this.src='{{ url_for('static', filename='image/default_product.png') }}'"
    />

    <!-- Quick View Overlay -->
    <div
      class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all flex items-center justify-center"
    >
      <span
        class="bg-white text-gray-800 px-4 py-2 rounded-full text-sm font-bold opacity-0 group-hover:opacity-100 transition-all transform translate-y-4 group-hover:translate-y-0 shadow-lg"
      >
        Ver Detalles
      </span>
    </div>

    {% if show_delete %}
    <div
      class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10"
    >
      <form
        action="{{ url_for('delete_product', product_id=product.id) }}"
        method="POST"
        onsubmit="return confirm('Â¿Eliminar producto?');"
      >
        <button
          class="bg-white text-red-500 p-2 rounded-full shadow-lg hover:bg-red-50"
        >
          <span class="material-symbols-outlined text-sm">delete</span>
        </button>
      </form>
    </div>
    {% endif %}
  </div>

  <!-- Content -->
  <div class="p-4 flex-1 flex flex-col">
    <div class="mb-2">
      <span
        class="text-xs font-bold uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-0.5 rounded"
      >
        {{ product.category }}
      </span>
    </div>
    <h3
      class="font-bold text-gray-800 mb-1 cursor-pointer hover:text-blue-600"
      onclick="openProductModal({{ product | tojson }})"
    >
      {{ product.name }}
    </h3>
    <p class="text-gray-500 text-sm line-clamp-2 mb-4 flex-1">
      {{ product.description }}
    </p>

    <div class="mt-auto pt-4 border-t border-gray-100">
      <div class="flex items-center justify-between mb-3">
        <span class="text-xl font-bold text-gray-900">
          S/ {{ "%.2f"|format(product.price) }}
        </span>
        <span class="text-xs text-gray-500"> Stock: {{ product.stock }} </span>
      </div>

      <form
        action="{{ url_for('add_to_cart', product_id=product.id) }}"
        method="POST"
        class="flex gap-2"
      >
        <div
          class="flex items-center border border-gray-300 rounded-lg bg-gray-50"
        >
          <button
            type="button"
            onclick="decrementQty(this)"
            class="px-2 py-1 text-gray-600 hover:bg-gray-200 rounded-l-lg"
          >
            -
          </button>
          <input
            type="number"
            name="quantity"
            value="1"
            min="1"
            max="{{ product.stock }}"
            class="w-10 text-center bg-transparent border-none p-0 text-sm focus:ring-0"
            readonly
          />
          <button
            type="button"
            onclick="incrementQty(this, {{ product.stock }})"
            class="px-2 py-1 text-gray-600 hover:bg-gray-200 rounded-r-lg"
          >
            +
          </button>
        </div>
        <button
          type="submit"
          class="flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center text-sm font-medium"
        >
          <span class="material-symbols-outlined text-sm mr-1"
            >add_shopping_cart</span
          >
          Agregar
        </button>
      </form>
    </div>
  </div>
</div>
{% endmacro %}
