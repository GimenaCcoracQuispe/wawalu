{% extends 'dashboard/base_dashboard.html' %}
{% block title %}Gestión de Pedidos - Wawalu{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
      <span class="text-gray-500 text-sm font-medium mb-1 block">Gestión Comercial > Pedidos</span>
      <h1 class="text-3xl font-bold text-gray-800">Gestión de Pedidos</h1>
    </div>
  </div>

  <!-- Table Card -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold tracking-wider">
            <th class="px-6 py-4">Pedido</th>
            <th class="px-6 py-4">Cliente</th>
            <th class="px-6 py-4">Total</th>
            <th class="px-6 py-4">Estado</th>
            <th class="px-6 py-4">Fecha</th>
            <th class="px-6 py-4 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for order in orders %}
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4">
              <div class="font-medium text-gray-800">#{{ order.id }}</div>
              <div class="text-xs text-gray-500">{{ order.payment_method }}</div>
            </td>
            <td class="px-6 py-4">
              <div class="font-medium text-gray-800">{{ order.user_name }}</div>
              <div class="text-xs text-gray-500">{{ order.user_email }}</div>
            </td>
            <td class="px-6 py-4 font-medium text-gray-800">
              S/. {{ "%.2f"|format(order.total_amount) }}
            </td>
            <td class="px-6 py-4">
              <select 
                class="status-select px-3 py-1 rounded-full text-xs font-medium border-0 focus:ring-2 focus:ring-blue-500 cursor-pointer
                {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800
                {% elif order.status == 'paid' %}bg-blue-100 text-blue-800
                {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                {% elif order.status == 'completed' %}bg-green-100 text-green-800
                {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                {% endif %}"
                data-order-id="{{ order.id }}"
                onchange="updateOrderStatus(this)"
              >
                <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pendiente</option>
                <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>Pagado</option>
                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Enviado</option>
                <option value="completed" {% if order.status == 'completed' %}selected{% endif %}>Completado</option>
                <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelado</option>
              </select>
            </td>
            <td class="px-6 py-4 text-sm text-gray-600">
              {{ order.created_at.strftime('%d/%m/%Y') if order.created_at else 'N/A' }}
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center justify-end gap-2">
                <a 
                  href="{{ url_for('order_detail', order_id=order.id) }}" 
                  class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  title="Ver Detalles"
                >
                  <span class="material-symbols-outlined">visibility</span>
                </a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
              <span class="material-symbols-outlined text-4xl mb-2 text-gray-300">shopping_cart</span>
              <p>No hay pedidos registrados.</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/manage_orders_admin.js') }}"></script>
{% endblock %}
