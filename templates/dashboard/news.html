{% extends "dashboard/base_dashboard.html" %} {% block title %}Noticias -
Wawalu{% endblock %} {% block content %}
<div class="max-w-5xl mx-auto">
  <!-- Header & Actions -->
  <div
    class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8"
  >
    <div>
      <h1 class="text-2xl font-bold text-gray-800">
        Noticias y Actualizaciones
      </h1>
      <p class="text-gray-500">
        Mantente informado de todo lo que sucede en Wawalu
      </p>
    </div>

    {% if session.get('user_role') in ['staff', 'admin'] %}
    <button
      onclick="document.getElementById('addNewsModal').classList.remove('hidden'); document.getElementById('addNewsModal').classList.add('flex');"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center shadow-sm"
    >
      <span class="material-symbols-outlined mr-2">post_add</span>
      Nueva Noticia
    </button>
    {% endif %}
  </div>

  <!-- News List -->
  {% if news_items %}
  <div class="space-y-8">
    {% for item in news_items %}
    <div
      class="bg-white rounded-2xl shadow-sm overflow-hidden flex flex-col md:flex-row hover:shadow-md transition-shadow duration-300"
    >
      <!-- Image -->
      <div class="md:w-1/3 h-64 md:h-auto bg-gray-100 relative">
        {% if item.image_url %}
        <img
          src="{{ url_for('serve_image', table='news', id=item.id) }}"
          alt="{{ item.title }}"
          class="w-full h-full object-cover"
          onerror="this.src='{{ url_for('static', filename='image/default_news.png') }}'"
        />
        {% else %}
        <div
          class="w-full h-full flex items-center justify-center text-gray-300 bg-gray-50"
        >
          <span class="material-symbols-outlined text-6xl">newspaper</span>
        </div>
        {% endif %}
      </div>

      <!-- Content -->
      <div class="p-6 md:p-8 flex-1 flex flex-col">
        <div class="flex items-center justify-between mb-3">
          <span class="text-sm text-gray-500 flex items-center">
            <span class="material-symbols-outlined text-base mr-1"
              >calendar_today</span
            >
            {{ item.created_at.strftime('%d %b, %Y') }}
          </span>

          {% if session.get('user_role') in ['staff', 'admin'] %}
          <form
            action="{{ url_for('delete_news', news_id=item.id) }}"
            method="POST"
            onsubmit="return confirm('¿Eliminar noticia?');"
          >
            <button
              type="submit"
              class="text-red-400 hover:text-red-600 p-1 rounded hover:bg-red-50 transition-colors"
            >
              <span class="material-symbols-outlined">delete</span>
            </button>
          </form>
          {% endif %}
        </div>

        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div
    class="text-center py-20 bg-white rounded-2xl border-2 border-dashed border-gray-200"
  >
    <span class="material-symbols-outlined text-6xl text-gray-300 mb-4"
      >feed</span
    >
    <h3 class="text-xl font-medium text-gray-500">No hay noticias recientes</h3>
    <p class="text-gray-400 mt-2">¡Pronto publicaremos novedades!</p>
  </div>
  {% endif %}
</div>

<!-- Add News Modal -->
<div
  id="addNewsModal"
  class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4"
>
  <div
    class="bg-white rounded-2xl shadow-xl max-w-2xl w-full overflow-hidden animate-fade-in"
  >
    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
      <h3 class="text-lg font-bold text-gray-800">Publicar Noticia</h3>
      <button
        onclick="document.getElementById('addNewsModal').classList.add('hidden'); document.getElementById('addNewsModal').classList.remove('flex');"
        class="text-gray-400 hover:text-gray-600"
      >
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <form
      action="{{ url_for('add_news') }}"
      method="POST"
      enctype="multipart/form-data"
      class="p-6 space-y-4"
    >
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Título</label
        >
        <input
          type="text"
          name="title"
          required
          class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"
          placeholder="Título de la noticia"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Contenido</label
        >
        <textarea
          name="content"
          rows="6"
          required
          class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"
          placeholder="Escribe el contenido de la noticia aquí..."
        ></textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Imagen Principal</label
        >
        <input
          type="file"
          name="image"
          accept="image/*"
          class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
        />
      </div>

      <div class="pt-4 flex justify-end gap-3">
        <button
          type="button"
          onclick="document.getElementById('addNewsModal').classList.add('hidden'); document.getElementById('addNewsModal').classList.remove('flex');"
          class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="bg-blue-600 text-white py-2 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/30"
        >
          Publicar
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
